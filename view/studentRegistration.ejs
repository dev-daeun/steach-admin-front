<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <% include ./title.ejs%>

    <!-- Bootstrap Core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <div id="navigation"></div>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">신규 학생 등록</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>

            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-lg-12">
                                      <div class="form-group col-lg-12">
                                        <h2>학생 기본정보</h2>
                                      </div>
                                      <div class="form-group col-lg-6">
                                        <label>전화상담 날짜</label>
                                        <input type="date" id="callingDay" name="callingDay" class="form-control">
                                      </div>
                                      <div class="form-group col-lg-6">      
                                        <label>방문상담 날짜</label>
                                        <input type="date" id="visitingDay" name="visitingDay" class="form-control">
                                     </div>
                                        <div class="form-group col-lg-4">
                                            <label>구분</label>
                                            <select id="consultStatus" name="consultStatus"class="form-control">
                                                <option value=3 selected>성공</option>
                                                <option value=2>전화실패</option>
                                                <option value=1>취소</option>
                                                <option value=0>퇴원</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-8">
                                            <label>실패 사유</label>
                                            <input id="failReason" name="failReason" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label>전화 상담가</label>
                                            <input id="calledConsultant" name="calledConsultant"class="form-control">
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label>방문 상담가</label>
                                            <input id="visitedConsultant" name="visitedConsultant"class="form-control">
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>알게된 경로</label>
                                            <select name="knownPath" id="knownPath" class="form-control">
                                                <option value='명함' selected>명함</option>
                                                <option value='소개'>소개</option>
                                                <option value='인터넷'>인터넷</option>
                                                <option value='기타'>기타</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label id="knownPathLabel" style="visibility:hidden">기타경로</label>
                                            <input type="text" class="form-control" name="knownPathEtc" id="knownPathEtc" style="visibility:hidden;"/>
                                        </div> 
                                        <div class="form-group col-lg-4">
                                            <label>이름</label>
                                            <input id="name" name="name"class="form-control">
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label>성별</label>
                                            <div class="form-group">
                                              <label class="radio-inline">
                                                  <input type="radio" id="gender" name="gender" value=0 checked>남
                                              </label>
                                              <label class="radio-inline">
                                                  <input type="radio" id="gender" name="gender" value=1>여
                                              </label>
                                            </div>
                                        </div>

                                        <div class="form-group col-lg-2">
                                            <label>주소(시/도)</label>
                                            <input type="text" id="address1" name="address1" class="form-control">
                                        </div>
                                         <div class="form-group col-lg-2">
                                            <label>주소(군/구)</label>
                                            <input type="text" id="address2" name="address2" class="form-control">
                                        </div>

                                        <div class="form-group col-lg-12">
                                            <label>상세 주소</label>
                                            <input type="text" id="address3" name="address3" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label>학교</label>
                                            <select name="school" id="school" class="form-control">
                                                <option value=1 selected>초</option>
                                                <option value=2>중</option>
                                                <option value=3>고</option>                                            
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>학교명</label>
                                            <input name="schoolName" id="schoolName" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>학년</label>
                                            <select name="grade" id="grade" class="form-control">
                                                <option selected>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                                <option>4</option>
                                                <option>5</option>
                                                <option>6</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>학생 연락처</label>
                                            <input name="phone"  placeholder="000-0000-0000" id="phone" class="form-control phone-number">
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>아버지 연락처</label>
                                            <input name="fatherPhone" placeholder="000-0000-0000" id="fatherPhone" class="form-control phone-number">
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>어머니 연락처</label>
                                            <input name="motherPhone"  placeholder="000-0000-0000" id="motherPhone" class="form-control phone-number">
                                        </div>
                                        <div class="form-group col-lg-3">
                                            <label>희망과목</label>
                                            <select id="subject" name="subject" class="form-control">
                                                <option value="국어" selected>국어</option>
                                                <option value="영어">영어</option>
                                                <option value="수학">수학</option>
                                                <option value="사회">사회</option>
                                                <option value="과학">과학</option>
                                                <option value="기타">기타</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-3">
                                            <label id="subjectLabel" style="visibility:hidden">기타 과목명</label>
                                            <input type="text" class="form-control" name="subjectEtc" id="subjectEtc" style="visibility:hidden;"/>
                                        </div>
                                        <div class="form-group col-lg-3">
                                            <label>수업형태</label>
                                            <select name= "classForm" id="classForm" class="form-control">
                                                <option value="개인방문" selected>개인방문</option>
                                                <option value="원내그룹" >원내그룹</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-3">
                                            <label>차량 지원</label>
                                            <div class="form-group">
                                              <label class="radio-inline">
                                                  <input type="radio" id="carProvided" name="carProvided" value=1 checked>Y
                                              </label>
                                              <label class="radio-inline">
                                                  <input type="radio" id="carProvided" name="carProvided" value=0>N
                                              </label>
                                            </div>
                                        </div>

                                        <div class="form-group col-lg-12">
                                            <label>학생 성향</label>
                                            <input id="studentMemo" name="studentMemo" class="form-control">
                                        </div>

                                        <div class="form-group col-lg-12">
                                          <h2>희망 사항</h2>
                                        </div>

                                        <div class="form-group col-lg-2">
                                            <label>나이대</label>
                                            <select id="teacherAge" name="teacherAge" class="form-control">
                                                <option value=20 selected>20대</option>
                                                <option value=30>30대</option>
                                                <option value=40>40대</option>
                                                <option value=50>50대</option>
                                                <option value=60>60대</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-2">
                                            <label>성별</label>
                                            <div class="form-group">
                                              <label class="radio-inline">
                                                  <input type="radio" id="teacherGender" name="teacherGender" value=0 checked>남
                                              </label>
                                              <label class="radio-inline">
                                                  <input type="radio" id="teacherGender" name="teacherGender" value=1>여
                                              </label>
                                            </div>
                                        </div>
                                        <div class="form-group col-lg-8">
                                            <label>희망하는 선생님 성향</label>
                                            <input id="recommended" name="recommended" class="form-control">
                                        </div>
                                        <div name="regularDate" id="regularDate" class="schedules">
                                          <div id="schedule0" class="form-group col-lg-12">
                                            <div class="form-group col-lg-6">
                                                <label>희망 요일</label>
                                                <div class="form-group" id="dayofweek">
                                                  <label class="radio-inline">
                                                      <input type="radio" name="day0" ￼value="일" checked>일
                                                  </label>
                                                  <label class="radio-inline">
                                                      <input type="radio" name="day0" value="월">월
                                                  </label>
                                                  <label class="radio-inline">
                                                      <input type="radio" name="day0" value="화">화
                                                  </label>
                                                  <label class="radio-inline">
                                                      <input type="radio" name="day0" value="수">수
                                                  </label>
                                                  <label class="radio-inline">
                                                      <input type="radio" name="day0" value="목">목
                                                  </label>
                                                  <label class="radio-inline">
                                                      <input type="radio" name="day0" value="금">금
                                                  </label>
                                                  <label class="radio-inline">
                                                      <input type="radio" name="day0" value="토">토
                                                  </label>
                                                </div>
                                            </div>
                                            <div class="form-group col-lg-6">
                                                <label>희망 시간</label>
                                                <div class="form-inline">
                                                    <select id="startMeridiem" name="startMeridiem" class="form-control">
                                                        <option value="오전" selected>오전</option>
                                                        <option value="오후">오후</option>
                                                    </select>
                                                    <select id="startHour" name="startHour" class="form-control">
                                                        <option value="01" selected>01</option>
                                                        <option value="02">02</option>
                                                        <option value="03">03</option>
                                                        <option value="04">04</option>
                                                        <option value="05">05</option>
                                                        <option value="06">06</option>
                                                        <option value="07">07</option>
                                                        <option value="08">08</option>
                                                        <option value="09">09</option>
                                                        <option value="10">10</option>
                                                        <option value="11">11</option>
                                                        <option value="12">12</option>
                                                    </select>
                                                    <label>시</label>
                                                    <select id="startMinute" name="startMinute" class="form-control">
                                                        <option value="00" selected>00</option>
                                                        <option value="10">10</option>
                                                        <option value="20">20</option>
                                                        <option value="30">30</option>
                                                        <option value="40">40</option>
                                                        <option value="50">50</option>
                                                    </select>
                                                    <label>분</label>
                                                    <label>~</label>
                                                    <select id="endMeridiem" name="endMeridiem" class="form-control">
                                                        <option value="오전" selected>오전</option>
                                                        <option value="오후">오후</option>
                                                    </select>
                                                    <select id="endHour" name="endHour" class="form-control">
                                                        <option value="01" selected>01</option>
                                                        <option value="02">02</option>
                                                        <option value="03">03</option>
                                                        <option value="04">04</option>
                                                        <option value="05">05</option>
                                                        <option value="06">06</option>
                                                        <option value="07">07</option>
                                                        <option value="08">08</option>
                                                        <option value="09">09</option>
                                                        <option value="10">10</option>
                                                        <option value="11">11</option>
                                                        <option value="12">12</option>
                                                    </select>
                                                    <label>시</label>
                                                    <select id="endMinute" name="endMinute" class="form-control">
                                                        <option value="00" selected>00</option>
                                                        <option value="10">10</option>
                                                        <option value="20">20</option>
                                                        <option value="30">30</option>
                                                        <option value="40">40</option>
                                                        <option value="50">50</option>
                                                    </select>
                                                    <label>분</label>
                                                </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="form-group col-lg-4 col-lg-offset-8 col-lg-pull-8">
                                            <input type=button id ='scheduleAddBtn' value="희망 수업일 추가"/>
                                        </div>
                                        <div class="form-group col-lg-4 col-lg-offset-8 col-lg-pull-8">
                                            <label>첫 수업 희망일</label>
                                            <input type="date" id="firstDate" name="firstDate" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>희망 교재</label>
                                            <input id="book" name="book" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>수강료</label>
                                            <input type="number" id="fee" name="fee" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>강의료</label>
                                            <input type="number" name="teacherFee" id="teacherFee" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-12">
                                          <h2>과거 기록</h2>
                                        </div>
                                        <div class="form-group col-lg-2 col-lg-offset-10 col-lg-pull-10">
                                            <label>현재등급</label>
                                            <select name="prevScore" id="prevScore" class="form-control">
                                                <option selected>1</option>
                                                <option>2</option>
                                                <option>3</option>
                                                <option>4</option>
                                                <option>5</option>
                                                <option>6</option>
                                                <option>7</option>
                                                <option>8</option>
                                                <option>9</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>수강했던 프로그램</label>
                                            <select id="prevProgram" name="prevProgram" class="form-control">
                                                <option value="학원" selected>학원</option>
                                                <option value="과외">과외</option>
                                                <option value="인강">인강</option>
                                                <option value="독학">독학</option>
                                                <option value="기타">기타</option>
                                            </select>
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label id="prevProgramLabel" style="visibility:hidden">기타 프로그램명</label>
                                            <input type="text" class="form-control" name="prevProgramEtc" id="prevProgramEtc" style="visibility:hidden;"/>
                                        </div>
                                        <div class="form-group col-lg-4">
                                            <label>기간</label>
                                          <div class="form-inline">
                                            <input type="date" id="prevStartTerm" name="prevStartTerm" class="form-control">
                                                <label style="text-align:center;width:auto;">~</label>
                                            <input type="date" id="prevEndTerm" name="prevEndTerm" class="form-control">
                                          </div>
                                        </div>

                                        <div class="form-group col-lg-6">
                                              <label>교재</label>
                                              <input id="prevUsedBook" name="prevUsedBook" class="form-control">
                                        </div>
                                        <div class="form-group col-lg-12">
                                              <label>좋았던 점</label>
                                              <textarea id="prevPros" name="prevPros" class="form-control"></textarea>
                                        </div>
                                        <div class="form-group col-lg-12">
                                              <label>아쉬웠던 점</label>
                                              <textarea id="prevCons" name="prevCons" class="form-control"></textarea>
                                        </div>
                                        <div class="form-group col-lg-12">
                                              <button type="submit" id="registerButton" class="center-block">등록</button>
                                        </div>
                                     <!-- </form>  -->
                                </div>
                                <!-- /.col-lg-6 (nested) -->
                            </div>
                            <!-- /.row (nested) -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->


        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->
    <!-- jQuery -->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/jquery/custom.js"></script>
    <script>
        $(() => {
            $("#navigation").loadNavigation();
            let knownPath =  $("#knownPath").find(":selected").prevObject[0].value, 
                subject = $("#subject").find(":selected").prevObject[0].value, 
                prevProgram = $("#prevProgram").find(":selected").prevObject[0].value;
            
            $("#knownPath").change((ent) => {
                knownPath = $(ent.target).openTextBox($('#knownPathEtc'), $("#knownPathLabel"));
            });
            $("#subject").change((ent) => {
                subject = $(ent.target).openTextBox($('#subjectEtc'), $("#subjectLabel"));
            });
            $("#prevProgram").change((ent) => {
                prevProgram = $(ent.target).openTextBox($('#prevProgramEtc'), $("#prevProgramLabel"));
            });

            $('#registerButton').click((ent) => {
            if(confirm('정말 등록하시겠습니까?')){
                if($('#name').val()=='' || $('#schoolName').val()=='') {
                    alert('학생 이름 및 학교명을 입력하세요.');
                    return ent.preventDefault;
                }
                let PhoneRegExp = /^\d{2,4}-\d{3,4}-\d{4}$/;
                let phones = document.querySelectorAll('.phone-number');
                for(let i in phones){
                    if(!phones[i].value) continue;
                    else if (!PhoneRegExp.test(phones[i].value)){
                        alert("잘못된 전화번호입니다. - 를 포함한 숫자만 입력하세요.");
                        return ent.preventDefault;
                    }
                }
                if(knownPath=='기타') knownPath = $('#knownPathEtc').val();
                if(subject=='기타') subject = $('#subjectEtc').val();
                if(prevProgram=='기타') prevProgram = $('#prevProgramEtc').val();
                //희망 수업일/시간
                let regularDate='';
                for(let i = 0; i < $("#regularDate").children().length; i++){
                    regularDate += $("#schedule"+i).find("#dayofweek").find(":checked").val() + ' '
                                 + $("#schedule"+i).find("#startMeridiem").val() + ' '
                                 + $("#schedule"+i).find("#startHour").val() + ':'
                                 + $("#schedule"+i).find("#startMinute").val() + '~'
                                 + $("#schedule"+i).find("#endMeridiem").val() + ' '
                                 + $("#schedule"+i).find("#endHour").val() + ':'
                                 + $("#schedule"+i).find("#endMinute").val()
                                 +' / ';
                }
               
                $.ajax({ 
                    url: '/student/registration',
                    processData: false,
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    data:  JSON.stringify({
                    assignment: {
                        regularDate: regularDate,
                        studentName: $("#name").val(),
                        callingDay: $("#callingDay").val() || new Date(),
                        visitingDay: $('#visiting_day').val() || new Date(),
                        consultStatus: $("#consultStatus").val(),
                        failReason: $('#failReason').val(),
                        calledConsultant: $('#calledConsultant').val(),
                        visitedConsultant: $("#visitedConsultant").val(),
                        knownPath: knownPath,
                        subject: subject,
                        classForm: $('#classForm').val(),
                        carProvided: $('#carProvided:checked').val(),
                        studentMemo: $('#studentMemo').val(),
                        teacherAge: $('#teacherAge').val(),
                        teacherGender: $('#teacherGender:checked').val(),
                        recommended: $('#recommended').val(),
                        firstDate: $('#firstDate').val() || new Date(),
                        book: $('#book').val(),
                        fee: $('#fee').val() || 0,
                        teacherFee: $('#teacherFee').val() || 0,
                        prevScore: $('#prevScore').val(),
                        prevProgram: prevProgram,
                        prevStartTerm: $('#prevStartTerm').val() || new Date(),
                        prevEndTerm: $('#prevEndTerm').val() || new Date(),
                        prevUsedBook: $('#prevUsedBook').val(),
                        prevPros: $('#prevPros').val(),
                        prevCons: $('#prevCons').val(),    
                    },
                    student: {
                        name:  $('#name').val(),
                        gender: $('#gender:checked').val(),
                        address1: $('#address1').val(),
                        address2: $('#address2').val(),
                        address3: $('#address3').val(),
                        school: $('#school').val(),
                        schoolName: $('#schoolName').val(),
                        grade: $('#grade').val(),
                        phone:$('#phone').val(),
                        fatherPhone: $('#fatherPhone').val(),
                        motherPhone: $('#motherPhone').val(),
                    }
                }), 
                success: function(data){
                    alert("등록완료 되었습니다.");
                    location.href = '/student/joined';
                },
                error: function(xhr, status, error){
                    alert(xhr.responseText);
                }
              });
            }
        });

        
            //html함수 적용하여 htmltest태그내의 html 변경
            $("#scheduleAddBtn").click(function() {
                var len = $("#regularDate").children().length;
                var tag = `<div id="schedule`+len+`" class="form-group col-lg-12">
                            <div class="form-group col-lg-6">
                                <label>희망 요일</label>
                                <div class="form-group" id="dayofweek">
                                <label class="radio-inline">
                                    <input type="radio"  name="day`+len+`" value="일" checked>일
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"  name="day`+len+`" value="월">월
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"  name="day`+len+`" value="화">화
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"  name="day`+len+`" value="수">수
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"  name="day`+len+`" value="목">목
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"  name="day`+len+`" value="금">금
                                </label>
                                <label class="radio-inline">
                                    <input type="radio"  name="day`+len+`" value="토">토
                                </label>
                                </div>
                            </div>
                            <div class="form-group col-lg-6">
                                <label>희망 시간</label>
                                <div class="form-inline">
                                    <select id="startMeridiem" name="startMeridiem" class="form-control">
                                        <option value="오전" selected>오전</option>
                                        <option value="오후">오후</option>
                                    </select>
                                    <select id="startHour" name="startHour" class="form-control">
                                        <option value="01" selected>01</option>
                                        <option value="02">02</option>
                                        <option value="03">03</option>
                                        <option value="04">04</option>
                                        <option value="05">05</option>
                                        <option value="06">06</option>
                                        <option value="07">07</option>
                                        <option value="08">08</option>
                                        <option value="09">09</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                    <label>시</label>
                                    <select id="startMinute" name="startMinute" class="form-control">
                                        <option value="00" selected>00</option>
                                        <option value="10">10</option>
                                        <option value="20">20</option>
                                        <option value="30">30</option>
                                        <option value="40">40</option>
                                        <option value="50">50</option>
                                    </select>
                                    <label>분</label>
                                    <label>~</label>
                                    <select id="endMeridiem" name="endMeridiem" class="form-control">
                                        <option value="오전" selected>오전</option>
                                        <option value="오후">오후</option>
                                    </select>
                                    <select id="endHour" name="endHour" class="form-control">
                                        <option value="01" selected>01</option>
                                        <option value="02">02</option>
                                        <option value="03">03</option>
                                        <option value="04">04</option>
                                        <option value="05">05</option>
                                        <option value="06">06</option>
                                        <option value="07">07</option>
                                        <option value="08">08</option>
                                        <option value="09">09</option>
                                        <option value="10">10</option>
                                        <option value="11">11</option>
                                        <option value="12">12</option>
                                    </select>
                                    <label>시</label>
                                    <select id="endMinute" name="endMinute" class="form-control">
                                        <option value="00" selected>00</option>
                                        <option value="10">10</option>
                                        <option value="20">20</option>
                                        <option value="30">30</option>
                                        <option value="40">40</option>
                                        <option value="50">50</option>
                                    </select>
                                    <label>분</label>
                                </div>
                            </div>`;
                $("#regularDate").append(tag);
            });
        });
    </script>
    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>

</body>

</html>
